<!DOCTYPE html>
<html xmlns:th="http//www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="UTF-8">
<title>KeeperCloset 이용후기</title>
<script src="https://kit.fontawesome.com/309845435e.js" crossorigin="anonymous"></script>
<style>
	/*	header*/
	
		* {
		margin:0;
		padding:0;
	}

	html,body {	
		height: 100%; 
		min-width: 1050px; 
	}

	a{
		text-decoration: none;
	}
	a:visited{
		color:white;
	}
	header{
		
		background-color: black;
	}
	
	.headerM{
		display: flex;
		flex-direction: row;
		flex-wrap: nowrap;
		justify-content: space-between;
		align-items: center;
		height: 150px;
		width: 980px;
		margin: 0 auto;
	}
	
	.mainlogo{
		font-size: 28px;
		font-weight: 500;
		color: white;
	}
	
	menu>ul{
		list-style: none;
		display: flex;
		flex-direction: row;
		flex-wrap: nowrap;
		justify-content: space-between;
		align-items: center;
		width: 500px;
	}
	
	menu>ul>li>a{
		color: white;
		font-size: 18px;
	}
/*	header end  */
	
	main{
		margin-top:100px;
		margin-bottom: 100px;
		
	}
	.reviewSection{
		margin-left: 12rem;
		margin-right: 12rem;
		position: relative;	
	}
	.reviewwrap{
		width: 650px;
    	margin: 0 auto;
	}
	.divwrap{
		margin-top: 75px;
	}
	.rformwrap{
		margin-top: 50px;
	}
	
	
	#reviewForm{
		display: flex;
    	flex-direction: column;
	}
	.inputWrap{
		width: 100%;
		border: 1px solid black;
		border-radius: 4px;
		margin-bottom: 20px;
		height: 42px;
		padding-left: 5px;
		display: flex;
		align-items: center;
	}
	.reviewInput{
		border: none;
		font-size: 18px;
		height: 30px;
		width: 600px;
	}
	.ttWrap{
		border: 1px solid black;
		width: 100%;
		height: 250px;
		padding-left: 5px;
		padding-top: 5px;
		border-radius: 4px;
	}
	#board_content{
		height: 100%;
		width: 650px;
		font-size: 14px;
		resize: none;
		border: none;
	}
	input,textarea:focus{
		outline: none !important;
	}
	i{
		background-color: gainsboro;
		font-size:35px;
	}
	i.fa-sharp.fa-thin.fa-plus{
		padding-left: 14px;
	    padding-right: 14px;
	    padding-top: 9px;
	    padding-bottom: 5px;
	    cursor: pointer;
	}
	.fa-plus:before {
		font-style: normal;
	}
	#display-image{
		display: flex;
	    flex-direction: row;
	    align-items: flex-start;
	    margin-top: 10px;
	}
	.preview{
		width:20%;
		margin-right: 5px;
	}
	.btnWrap{
		display: flex;
		width: 100%;
		margin-top: 20px;
		height: 40px;
	}
	.btnstyle{
		width: 50%;
	}
	#reList,#dobtn{
		width: 100%;
    	height: 100%;
		border: none;
		cursor: pointer;
	}
	#dobtn{
		background-color: black;
    	color: white;
	}
</style>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"
	integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
	crossorigin="anonymous"></script>

<script>
	function writeReview(rvnum){
		var form = $('#reviewForm')[0];
	    var data = new FormData(form);
	    
		
			$.ajax({
				url : '/user/review/addreview/'+rvnum,
				type : 'post',
				enctype: 'multipart/form-data',
				cache : false,
				processData: false,   
	            contentType: false, 
				data : data,
				dataType : 'json',
				success : function(res) {
					alert(res.ok?"등록 성공":"등록 실패");
					if(res.ok) location.href="/user/review/result/"+rvnum;
				},
				error : function(xhr, status, err) {
					alert(status + ", " + err);
				}
			});
		
	}
	
	function getImage(input){
		
		var max = 3;
		var cur=input.files.length;
		
		if(cur>max){
			alert('첨부파일은 3개까지 첨부가능합니다.');
		} else{
			if(input.files){
				var divImg=document.getElementById('display-image');
				
				Array.from(input.files).forEach(file =>{
					if(divImg.querySelectorAll('.preview').length>max){
						alert('최대 3개의 이미지만 선택 가능합니다.');
						return;
					}
					var reader = new FileReader();
					reader.onload=function(event){
						var img = document.createElement('img');
						img.src=event.target.result;
						img.className='preview';
						img.onclick = function() {
	                        deleteImg(this);
	                    };
						divImg.appendChild(img);
					};
					reader.readAsDataURL(file);
				})
			}
		}
	}
	
   function deleteImg(img) {
        img.parentNode.removeChild(img); // 클릭된 이미지를 부모 요소에서 삭제
    }
</script>
</head>
<body>
	<header>
		<div class="headerM">
			<div class="mainlogo">
				<a href="/keep/main">KeeperCloset</a>
			</div>
			<menu>
				<ul>
					<li>
						<a href="/rv/keeping">예약하기</a>
					</li>
					<li>
						<a href="/review/list">이용후기</a>
					</li>
					<li>
						<a href="">문의사항</a>
					</li>
					<li>
						<th:block sec:authorize="isAnonymous()">
							<a href="/user/login">로그인</a>
						</th:block>
						<th:block sec:authorize="isAuthenticated()">
							<a href="/user/mypage" sec:authentication="principal.member.id">
						</th:block>
					</li>
				</ul>
			</menu>
			<div class="logoutT" sec:authorize="isAuthenticated()">
					<a href="/logout">로그아웃</a>
			</div>
		</div>
	</header>
	<main>
		<section class="reviewSection">
			<div class="reviewwrap">
				<div><h1>후기작성</h1></div>
				<div class="divwrap">
					<div class="rvdetail">
						<div>
							[[${rv.rv_name}]]님
							
						</div>
						<div class="rvAtt">
							[[${rv.store.st_name}]]
						</div>
						<div>
							[[${rv.startdate}]] ~ [[${rv.enddate}]]이용
						</div>
					</div>
					<div class="rformwrap">
						<form id="reviewForm" method="post">
							<input type="hidden" name="rvnum" th:value="${rv.rvnum}">
							<!-- <div class="inputWrap">
								<input class="reviewInput" type="text" name="board_title" id="board_title" >
							</div> -->
							<div class="ttWrap">
								<textarea  name="board_content" id="board_content" cols="40" rows="8"></textarea>
							</div>
							<div style="margin-top:10px">
								<label for="files"><i class="fa-sharp fa-thin fa-plus"></i></label>
								<input type="file" name="files" id="files" multiple="multiple" accept="image/*"
									style="display:none; visibility:none;" onchange="getImage(this);">
							</div>
							<div id="display-image">
							</div>
							<div class="btnWrap">
								<div class="btnstyle">
									<button id="reList" type="button" onclick="location.href='/user/mypage/checkdetails'">취소</button>
								</div>
								<div class="btnstyle">
									<button id="dobtn" type="button" th:onclick="writeReview([[${rv.rvnum}]])">등록</button>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</section>
	</main>
</body>
</html>